<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <title>
    
    8. Tietokantojen teoria - Tietokantojen perusteet syksy 2023
    
  </title>
  <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        CommonHTML: {
          scale: 87
        }
      });
      </script>
  <script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>
  <link rel='stylesheet' type='text/css' media='screen' href=/syksy-2023/assets/css/main.css>
  <link rel='stylesheet' type='text/css' media='screen' href=/syksy-2023/assets/css/syntax.css>

  <script src=/syksy-2023/assets/js/main.js></script>

</head>


<body id="chapter">
    
<nav class="no-nav" id="side-nav" >
    <button id="hide" onclick="hideSideNav()"> &#x2715;</button>
    <button id="show" onclick="showSideNav()"> </button>
    <h2>Tietokantojen perusteet syksy 2023</h2>
    
    <ol>

        <li class="side-nav-obj" id="indexnav"><a href=/syksy-2023/index>Etusivu </a></li>
        
        
        
        <li class="side-nav-obj" id="Materiaalinav"><a href="/syksy-2023/pages/materiaali.html">Materiaali</a></li>
        
        
        
        
        
        <li class="side-nav-obj" id="Tehtävätnav"><a href="/syksy-2023/pages/tehtavat.html">Tehtävät</a></li>
        
        
        
        
        
        <li class="side-nav-obj" id="Tulokset ja palautenav"><a href="/syksy-2023/pages/tulokset_palaute.html">Tulokset ja palaute</a></li>
        
        
        <br>
        
        
        <li class="side-nav-obj" id="1. Johdantonav"><a href="/syksy-2023/content/osa-1/index.html">1. Johdanto</a></li>
        
        
            
            <li class="side-nav-sub-obj" id="Mikä on tietokantanav"><a href="/syksy-2023/content/osa-1/index.html#mikä-on-tietokanta">Mikä on tietokanta</a></li>
        
            
            <li class="side-nav-sub-obj" id="Tee-se-itse-tietokantanav"><a href="/syksy-2023/content/osa-1/index.html#tee-se-itse-tietokanta">Tee-se-itse-tietokanta</a></li>
        
            
            <li class="side-nav-sub-obj" id="Relaatiomalli ja SQL-kielinav"><a href="/syksy-2023/content/osa-1/index.html#relaatiomalli-ja-sql-kieli">Relaatiomalli ja SQL-kieli</a></li>
        
            
        
        
        
        
        <li class="side-nav-obj" id="2. SQL-kielen perusteetnav"><a href="/syksy-2023/content/osa-2/index.html">2. SQL-kielen perusteet</a></li>
        
        
            
            <li class="side-nav-sub-obj" id="Peruskomennotnav"><a href="/syksy-2023/content/osa-2/index.html#peruskomennot">Peruskomennot</a></li>
        
            
            <li class="side-nav-sub-obj" id="Yhteenveto ja ryhmittelynav"><a href="/syksy-2023/content/osa-2/index.html#yhteenveto-ja-ryhmittely">Yhteenveto ja ryhmittely</a></li>
        
            
            <li class="side-nav-sub-obj" id="SQLite-tietokantanav"><a href="/syksy-2023/content/osa-2/index.html#sqlite-tietokanta">SQLite-tietokanta</a></li>
        
            
        
        
        
        
        <li class="side-nav-obj" id="3. Monen taulun kyselytnav"><a href="/syksy-2023/content/osa-3/index.html">3. Monen taulun kyselyt</a></li>
        
        
            
            <li class="side-nav-sub-obj" id="Taulujen viittauksetnav"><a href="/syksy-2023/content/osa-3/index.html#taulujen-viittaukset">Taulujen viittaukset</a></li>
        
            
            <li class="side-nav-sub-obj" id="Liitostaulutnav"><a href="/syksy-2023/content/osa-3/index.html#liitostaulut">Liitostaulut</a></li>
        
            
            <li class="side-nav-sub-obj" id="JOIN-syntaksinav"><a href="/syksy-2023/content/osa-3/index.html#join-syntaksi">JOIN-syntaksi</a></li>
        
            
        
        
        
        
        <li class="side-nav-obj" id="4. Lisää SQL-kielestänav"><a href="/syksy-2023/content/osa-4/index.html">4. Lisää SQL-kielestä</a></li>
        
        
            
            <li class="side-nav-sub-obj" id="Tyypit ja lausekkeetnav"><a href="/syksy-2023/content/osa-4/index.html#tyypit-ja-lausekkeet">Tyypit ja lausekkeet</a></li>
        
            
            <li class="side-nav-sub-obj" id="NULL-arvotnav"><a href="/syksy-2023/content/osa-4/index.html#null-arvot">NULL-arvot</a></li>
        
            
            <li class="side-nav-sub-obj" id="Tulosrivien rajausnav"><a href="/syksy-2023/content/osa-4/index.html#tulosrivien-rajaus">Tulosrivien rajaus</a></li>
        
            
            <li class="side-nav-sub-obj" id="Alikyselytnav"><a href="/syksy-2023/content/osa-4/index.html#alikyselyt">Alikyselyt</a></li>
        
            
            <li class="side-nav-sub-obj" id="Lisää tekniikoitanav"><a href="/syksy-2023/content/osa-4/index.html#lisää-tekniikoita">Lisää tekniikoita</a></li>
        
            
        
        
        
        
        <li class="side-nav-obj" id="5. Tietokannat ohjelmoinnissanav"><a href="/syksy-2023/content/osa-5/index.html">5. Tietokannat ohjelmoinnissa</a></li>
        
        
            
            <li class="side-nav-sub-obj" id="Tietokannan käyttäminennav"><a href="/syksy-2023/content/osa-5/index.html#tietokannan-käyttäminen">Tietokannan käyttäminen</a></li>
        
            
            <li class="side-nav-sub-obj" id="Käyttöliittymänav"><a href="/syksy-2023/content/osa-5/index.html#käyttöliittymä">Käyttöliittymä</a></li>
        
            
            <li class="side-nav-sub-obj" id="Mitä tehdä missäkinnav"><a href="/syksy-2023/content/osa-5/index.html#mitä-tehdä-missäkin">Mitä tehdä missäkin</a></li>
        
            
        
        
        
        
        <li class="side-nav-obj" id="6. Tietokannan suunnittelunav"><a href="/syksy-2023/content/osa-6/index.html">6. Tietokannan suunnittelu</a></li>
        
        
            
            <li class="side-nav-sub-obj" id="Suunnittelun periaatteetnav"><a href="/syksy-2023/content/osa-6/index.html#suunnittelun-periaatteet">Suunnittelun periaatteet</a></li>
        
            
            <li class="side-nav-sub-obj" id="Tiedon atomisuusnav"><a href="/syksy-2023/content/osa-6/index.html#tiedon-atomisuus">Tiedon atomisuus</a></li>
        
            
            <li class="side-nav-sub-obj" id="Toisteinen tietonav"><a href="/syksy-2023/content/osa-6/index.html#toisteinen-tieto">Toisteinen tieto</a></li>
        
            
            <li class="side-nav-sub-obj" id="Suunnitteluesimerkkinav"><a href="/syksy-2023/content/osa-6/index.html#suunnitteluesimerkki">Suunnitteluesimerkki</a></li>
        
            
        
        
        
        
        <li class="side-nav-obj" id="7. Tietokannan ominaisuudetnav"><a href="/syksy-2023/content/osa-7/index.html">7. Tietokannan ominaisuudet</a></li>
        
        
            
            <li class="side-nav-sub-obj" id="Tiedon eheysnav"><a href="/syksy-2023/content/osa-7/index.html#tiedon-eheys">Tiedon eheys</a></li>
        
            
            <li class="side-nav-sub-obj" id="Transaktiotnav"><a href="/syksy-2023/content/osa-7/index.html#transaktiot">Transaktiot</a></li>
        
            
            <li class="side-nav-sub-obj" id="Kyselyjen suoritusnav"><a href="/syksy-2023/content/osa-7/index.html#kyselyjen-suoritus">Kyselyjen suoritus</a></li>
        
            
            <li class="side-nav-sub-obj" id="Indeksitnav"><a href="/syksy-2023/content/osa-7/index.html#indeksit">Indeksit</a></li>
        
            
        
        
        
        
        <li class="side-nav-obj" id="8. Tietokantojen teorianav"><a href="/syksy-2023/content/osa-8/index.html">8. Tietokantojen teoria</a></li>
        
        
            
            <li class="side-nav-sub-obj" id="Matemaattinen taustanav"><a href="/syksy-2023/content/osa-8/index.html#matemaattinen-tausta">Matemaattinen tausta</a></li>
        
            
            <li class="side-nav-sub-obj" id="Taulu relaationanav"><a href="/syksy-2023/content/osa-8/index.html#taulu-relaationa">Taulu relaationa</a></li>
        
            
            <li class="side-nav-sub-obj" id="Relaatio-operaatiotnav"><a href="/syksy-2023/content/osa-8/index.html#relaatio-operaatiot">Relaatio-operaatiot</a></li>
        
            
            <li class="side-nav-sub-obj" id="Avaimet ja riippuvuudetnav"><a href="/syksy-2023/content/osa-8/index.html#avaimet-ja-riippuvuudet">Avaimet ja riippuvuudet</a></li>
        
            
            <li class="side-nav-sub-obj" id="Normaalimuodotnav"><a href="/syksy-2023/content/osa-8/index.html#normaalimuodot">Normaalimuodot</a></li>
        
            
        
        
        
    </ol>
</nav>

    <div class="page-content">
        <div class="content">
    <div class="table-of-content" id="tof" style="display: none;">
    <ul>
        
        <li><a href="#matemaattinen-tausta">Matemaattinen tausta</a></li>
        
        <li><a href="#taulu-relaationa">Taulu relaationa</a></li>
        
        <li><a href="#relaatio-operaatiot">Relaatio-operaatiot</a></li>
        
        <li><a href="#avaimet-ja-riippuvuudet">Avaimet ja riippuvuudet</a></li>
        
        <li><a href="#normaalimuodot">Normaalimuodot</a></li>
        
    </ul>
</div>

    <h1 id="8-tietokantojen-teoria">8. Tietokantojen teoria</h1>

<p>Tietokannan sisällön esittäminen relaatiomallin mukaisesti tauluina ja riveinä tuntuu nykyään lähes itsestään selvältä tavalta, mutta tämä oli aikoinaan mullistava idea tietokanta-alalla. Tässä luvussa tutustumme relaatiomallin matemaattiseen taustaan, joka syntyi 1970-luvulla.</p>

<h2 id="matemaattinen-tausta">Matemaattinen tausta</h2>

<h3 id="joukko">Joukko</h3>

<p><em>Joukko</em> (<em>set</em>) on kokoelma alkioita. Esimerkiksi \(A=\{1,2,3,4,5\}\) ja \(B=\{apina, banaani, cembalo\}\) ovat joukkoja.</p>

<p>Merkintä \(\mid S \mid\) tarkoittaa joukon \(S\) alkioiden määrää. Äskeisessä esimerkissä \(\mid A \mid=5\) ja \(\mid B \mid =3\).</p>

<p>Merkintä \(x \in S\) tarkoittaa, että alkio \(x\) kuuluu joukkoon \(S\).</p>

<p>Joukon alkioilla ei ole tiettyä järjestystä. Esimerkiksi \(\{1,2,3\}\), \(\{1,3,2\}\) ja \(\{2,3,1\}\) tarkoittavat samaa joukkoa.</p>

<p>Tietty alkio voi esiintyä joukossa enintään kerran. Esimerkiksi \(\{1,2,1\}\) ei ole joukko, koska alkio \(1\) esiintyy kahdesti.</p>

<h3 id="osajoukko">Osajoukko</h3>

<p><em>Osajoukko</em> (<em>subset</em>) sisältää osan joukon alkioista. Esimerkiksi joukon \(\{1,2,3\}\) osajoukot ovat \(\emptyset\), \(\{1\}\), \(\{2\}\), \(\{3\}\), \(\{1,2\}\), \(\{1,3\}\), \(\{2,3\}\) ja \(\{1,2,3\}\). Merkintä \(\emptyset\) tarkoittaa tyhjää joukkoa.</p>

<p>Merkintä \(A \subset B\) tarkoittaa, että joukko \(A\) on joukon \(B\) osajoukko.</p>

<p>Osajoukko on <em>aito</em> (<em>proper</em>), jos siinä ei ole kaikkia joukon alkioita.</p>

<p>Kun joukossa on \(n\) alkiota, siitä voidaan muodostaa \(2^n\) osajoukkoa. Esimerkiksi joukossa \(\{1,2,3\}\) on \(3\) alkiota, joten osajoukkoja on \(2^3=8\).</p>

<h3 id="monikko">Monikko</h3>

<p><em>Monikko</em> (<em>tuple</em>) on lista alkioita tietyssä järjestyksessä. Esimerkiksi \((1,3,2)\) on monikko, jossa on \(3\) alkiota.</p>

<p>Monikossa alkioiden järjestyksellä on merkitystä. Esimerkiksi \((1,2,3)\), \((1,3,2)\) ja \((2,3,1)\) ovat kolme eri monikkoa.</p>

<p>Monikossa sama alkio voi toistua monta kertaa. Esimerkiksi \((1,2,1)\) on monikko, jossa toistuu kahdesti alkio \(1\).</p>

<h3 id="karteesinen-tulo">Karteesinen tulo</h3>

<p><em>Karteesinen tulo</em> (<em>Cartesian product</em>) \(S_1 \times S_2 \times \dots \times S_k\) sisältää kaikki monikot, jotka muodostuvat valitsemalla järjestyksessä yksi alkio jokaisesta joukosta \(S_1,S_2,\dots,S_k\).</p>

<p>Kun \(A=\{1,2,3\}\) ja \(B=\{x,y,z\}\), niin</p>

\[A \times B = \{(1,x),(1,y),(1,z),(2,x),(2,y),(2,z),(3,x),(3,y),(3,z)\}.\]

<p>Kun \(A=\{1,2,3\}\), \(B=\{x\}\) ja \(C=\{1,2\}\), niin</p>

\[A \times B \times C = \{(1,x,1), (1,x,2), (2,x,1), (2,x,2), (3,x,1), (3,x,2)\}.\]

<p>Karteesisen tulon alkioiden määrä on \(\mid S_1 \mid \cdot \mid S_2 \mid \dots \mid S_k \mid\). Esimerkiksi kun \(\mid A \mid = 3\), \(\mid B \mid = 1\) ja \(\mid C \mid = 2\), karteesinen tulo \(A \times B \times C\) muodostuu \(3 \cdot 1 \cdot 2 = 6\) alkiosta.</p>

<h3 id="relaatio">Relaatio</h3>

<p><em>Relaatio</em> (<em>relation</em>) on karteesisen tulon osajoukko. Kun \(A=\{1,2,3\}\) ja \(B=\{x,y,z\}\), niin mahdollisia karteesisen tulon \(A \times B\) relaatioita ovat esimerkiksi seuraavat:</p>

\[R_1 = \{(1,x),(1,y),(1,z)\}\]

\[R_2 = \{(1,x),(2,x),(2,z),(3,y)\}\]

\[R_3 = \{(2,y)\}\]

<p>Relaatio tarkoittaa siis sitä, että valitaan jokin osajoukko kaikista mahdollisista alkioiden muodostamista yhdistelmistä.</p>

<p>Karteesisella tulolla \(S_1 \times S_2 \times \dots \times S_k\) on kaikkiaan \(2^{\mid S_1 \mid \cdot \mid S_2 \mid \dots \mid S_k \mid}\) mahdollista relaatiota.</p>

<h2 id="taulu-relaationa">Taulu relaationa</h2>

<p>Tietokannan taulu voidaan esittää matemaattisesti relaationa, jonka jokainen monikko vastaa yhtä taulun riviä. Kun taulussa on \(k\) saraketta, relaatiossa jokaisessa monikossa on vastaavasti \(k\) alkiota, joista käytetään nimeä attribuutti. Relaation taustalla on karteesinen tulo</p>

\[S_1 \times S_2 \times \dots \times S_k,\]

<p>jossa joukot \(S_1,S_2,\dots,S_k\) ilmaisevat, mitä arvoja kussakin attribuutissa voi olla eli kunkin attribuutin tyypin.</p>

<h3 id="esimerkki">Esimerkki</h3>

<p>Tarkastellaan esimerkkinä taulua <code class="language-html highlighter-rouge">Tuotteet</code>, jossa on tietoa tuotteista:</p>

<table class="db-table">
<thead>
  <tr><th colspan="3" id="table-title">Tuotteet</th></tr>
  <tr><th width="30">id</th><th width="100">nimi</th><th width="70">hinta</th></tr>
</thead>
<tbody>
  <tr><td>1</td><td>retiisi</td><td>7</td></tr>
  <tr><td>2</td><td>porkkana</td><td>5</td></tr>
  <tr><td>3</td><td>nauris</td><td>4</td></tr>
  <tr><td>4</td><td>lanttu</td><td>8</td></tr>
  <tr><td>5</td><td>selleri</td><td>4</td></tr>
</tbody>
</table>

<p>Tämä taulu vastaa relaatiota</p>

\[T=\{(1,retiisi,7),(2,porkkana,5),(3,nauris,4),(4,lanttu,8),(5,selleri,4)\},\]

<p>jonka jokainen monikko muodostuu kolmesta attribuutista <code class="language-html highlighter-rouge">id</code>, <code class="language-html highlighter-rouge">nimi</code> ja <code class="language-html highlighter-rouge">hinta</code>.</p>

<p>Tässä tapauksessa relaation taustalla on karteesinen tulo \(S_1 \times S_2 \times S_3\). Joukot \(S_1,S_2,S_3\) määrittelevät attribuuttien tyypit eli jokainen joukko sisältää kaikki arvot, joita vastaavassa attribuutissa voi olla.</p>

<p>Esimerkiksi attribuutti <code class="language-html highlighter-rouge">id</code> on positiivinen kokonaisluku, joten \(S_1\) voisi olla \(\{1,2,3,\dots\}\) eli ääretön joukko, joka sisältää kaikki positiiviset kokonaisluvut. Toinen mahdollisuus on, että id-numerolla on yläraja, kuten yleensä käytännön tietokannoissa. Esimerkiksi jos id-numero on 64-bittinen kokonaisluku, \(S_1\) voisi olla \(\{1,2,3,\dots,2^{64}-1\}\).</p>

<h3 id="teoria-vs-käytäntö">Teoria vs. käytäntö</h3>

<p>SQL-tietokannat perustuvat relaatiomalliin, mutta ne eivät kuitenkaan täysin noudata sitä.</p>

<p>Yksi ero on, että relaatiossa jokainen monikko on erilainen (koska relaatio on joukko), mutta SQL-taulussa ei ole tätä rajoitusta. Esimerkiksi voimme luoda seuraavasti taulun <code class="language-html highlighter-rouge">Testi</code> ja lisätä siihen kolme samanlaista riviä:</p>

<div class="language-prompt highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="p">sqlite&gt; </span>CREATE TABLE Testi (x INTEGER);
<span class="p">sqlite&gt; </span>INSERT INTO Testi VALUES (1);
<span class="p">sqlite&gt; </span>INSERT INTO Testi VALUES (1);
<span class="p">sqlite&gt; </span>INSERT INTO Testi VALUES (1);
<span class="p">sqlite&gt; </span>SELECT * FROM Testi;
1
1
1
</code></pre></div></div>

<p>Usein tosin SQL-taulussa on sarake <code class="language-html highlighter-rouge">id</code>, joka takaa, että taulussa ei ole kahta samanlaista riviä, koska jokaisella rivillä on eri id-numero.</p>

<p>Toinen ero on, että relaatiossa jokaisella monikon attribuutilla tulee olla arvo mutta SQL-taulussa sarakkeessa voi olla <code class="language-html highlighter-rouge">NULL</code> eli arvo puuttuu.</p>

<h2 id="relaatio-operaatiot">Relaatio-operaatiot</h2>

<p>Relaatio-operaatioiden avulla olemassa olevista relaatioista voidaan muodostaa uusi relaatio. Tämä vastaa SQL:ssä kyselyä, jossa tauluista muodostetaan tulostaulu. Tutustumme seuraavaksi esimerkkinä kolmeen keskeiseen relaatio-operaatioon: projektio, restriktio ja liitos.</p>

<h3 id="projektio">Projektio</h3>

<p>Projektio \(\Pi\) muodostaa relaation, jossa monikoista valitaan tietyt attribuutit. Projektio vastaa SQL-kyselyä, jossa valitaan tietyt sarakkeet taulusta. Esimerkiksi projektio \(\Pi_{nimi,hinta}(T)\) vastaa SQL-kyselyä <code class="language-html highlighter-rouge">SELECT nimi, hinta FROM Tuotteet</code>.</p>

<p>Esimerkkejä:</p>

\[\Pi_{nimi}(T) = \{(retiisi),(porkkana),(nauris),(lanttu),(selleri)\}\]

\[\Pi_{hinta}(T) = \{(7),(5),(4),(8)\}\]

\[\Pi_{nimi,hinta}(T) = \{(retiisi,7),(porkkana,5),(nauris,4),(lanttu,8),(selleri,4)\}\]

<p>Huomaa, että mahdolliset toistuvat monikot suodattuvat pois projektiosta. Tämän takia projektiossa \(\Pi_{hinta}(T)\) on vain neljä monikkoa, koska kahdella tuotteella on sama hinta.</p>

<h3 id="restriktio">Restriktio</h3>

<p>Restriktio \(\sigma\) muodostaa relaation, jossa on tietyt ehdot täyttävät monikot. Restriktio vastaa SQL-kyselyä, jossa rivit valitaan <code class="language-html highlighter-rouge">WHERE</code>-osassa. Esimerkiksi restriktio \(\sigma_{hinta \le 5}(T)\) vastaa SQL-kyselyä <code class="language-html highlighter-rouge">SELECT * FROM Tuotteet WHERE hinta <span class="nt">&lt;</span><span class="err">=</span> <span class="na">5</span></code>.</p>

<p>Esimerkkejä:</p>

\[\sigma_{nimi = nauris}(T)=\{(3,nauris,4)\}\]

\[\sigma_{hinta = 4}(T)=\{(3,nauris,4),(5,selleri,4)\}\]

\[\sigma_{hinta \le 5}(T)=\{(2,porkkana,5),(3,nauris,4),(5,selleri,4)\}\]

<p>Yhdistämällä projektio ja restriktio saadaan vastine esimerkiksi SQL-kyselylle <code class="language-html highlighter-rouge">SELECT nimi FROM Tuotteet WHERE hinta <span class="nt">&lt;</span><span class="err">=</span> <span class="na">5</span></code>:</p>

\[\Pi_{nimi}(\sigma_{hinta \le 5}(T))=\{(porkkana),(nauris),(selleri)\}\]

<h3 id="liitos">Liitos</h3>

<p>Liitos \(\bowtie\) muodostaa relaation, jonka monikot on koostettu kahden relaation pohjalta. Tämä vastaa SQL:ssä kahden taulun kyselyä.</p>

<p>Tarkastellaan esimerkkinä seuraavia tauluja <code class="language-html highlighter-rouge">Henkilot</code> ja <code class="language-html highlighter-rouge">Yritykset</code>:</p>

<table class="db-table">
<thead>
  <tr><th colspan="3" id="table-title">Henkilot</th></tr>
  <tr><th width="30">id</th><th width="100">nimi</th><th width="70">yritys_id</th></tr>
</thead>
<tbody>
  <tr><td>1</td><td>Maija</td><td>1</td></tr>
  <tr><td>2</td><td>Liisa</td><td>1</td></tr>
  <tr><td>3</td><td>Kaaleppi</td><td>3</td></tr>
</tbody>
</table>

<table class="db-table">
<thead>
  <tr><th colspan="3" id="table-title">Yritykset</th></tr>
  <tr><th width="30">id</th><th width="100">nimi</th></tr>
</thead>
<tbody>
  <tr><td>1</td><td>Google</td></tr>
  <tr><td>2</td><td>Amazon</td></tr>
  <tr><td>3</td><td>Facebook</td></tr>
</tbody>
</table>

<p>Näitä tauluja vastaavat seuraavat relaatiot:</p>

\[H = \{(1,Maija,1),(2,Liisa,1),(3,Kaaleppi,3)\}\]

\[Y = \{(1,Google),(2,Amazon),(3,Facebook)\}\]

<p>Nyt kyselyä <code class="language-html highlighter-rouge">SELECT * FROM Henkilot H, Yritykset Y WHERE H.yritys_id = Y.id</code> vastaa seuraava relaatio-operaatio:</p>

\[{H\ \bowtie\ Y \atop \small H.yritys\_id = Y.id} = \{(1,Maija,1,1,Google),(2,Liisa,1,1,Google),(3,Kaaleppi,3,3,Facebook)\}\]

<p>Yhdistämällä tähän projektion saamme haettua kunkin henkilön nimen ja yrityksen nimen:</p>

\[\Pi_{H.nimi,Y.nimi}({H\ \bowtie\ Y \atop \small H.yritys\_id = Y.id}) = \{(Maija,Google),(Liisa,Google),(Kaaleppi,Facebook)\}\]

<h3 id="teoria-vs-käytäntö-1">Teoria vs. käytäntö</h3>

<p>Relaatio-operaatioiden avulla voidaan toteuttaa hakuja samaan tapaan kuin SQL-kyselyillä, mutta tässäkin SQL-kielessä on joitakin eroja.</p>

<p>Kuten näimme aiemmin, projektio \(\Pi_{hinta}(T)\) sisältää jokaisen eri hinnan vain kerran, kun taas kyselyn <code class="language-html highlighter-rouge">SELECT hinta FROM Tuotteet</code> tulostaulussa voi olla monta kertaa sama hinta. SQL:ssä on itse asiassa kaksi eri tapaa hakea tietoa:</p>

<ul>
  <li><code class="language-html highlighter-rouge">SELECT ALL ...</code>: haetaan kaikki rivit, myös toistuvat rivit</li>
  <li><code class="language-html highlighter-rouge">SELECT DISTINCT ...</code>: haetaan jokainen erilainen rivi vain kerran</li>
</ul>

<p>Ensimmäinen tapa on oletus ja sanaa <code class="language-html highlighter-rouge">ALL</code> ei käytetä yleensä, mutta toistuvat rivit voidaan poistaa sanan <code class="language-html highlighter-rouge">DISTINCT</code> avulla. Tarkasti ottaen projektiota \(\Pi_{hinta}(T)\) vastaa siis kysely <code class="language-html highlighter-rouge">SELECT DISTINCT hinta FROM Tuotteet</code>.</p>

<p>Lisäksi SQL:ssä rivien järjestyksellä voi olla väliä, kun taas relaation monikoilla ei ole järjestystä. Rivien järjestys näkyy SQL:ssä esimerkiksi kyselyssä, jonka lopussa on <code class="language-html highlighter-rouge">ORDER BY</code>, jolloin tulostaulun rivit ovat halutussa järjestyksessä. Relaatio-operaatioilla ei ole mahdollista toteuttaa tällaista hakua.</p>

<h2 id="avaimet-ja-riippuvuudet">Avaimet ja riippuvuudet</h2>

<p><em>Yliavain</em> (<em>superkey</em>) on attribuuttien yhdistelmä, joka on varmasti erilainen jokaisessa relaation monikossa. Yliavain yksilöi siis jokaisen relaatiossa olevan monikon.</p>

<p><em>Kandidaattiavain</em> (<em>candidate key</em>) eli <em>avain</em> (<em>key</em>) on minimaalinen yliavain. Tämä tarkoittaa, että jos poistetaan mikä tahansa attribuutti, niin kyseessä ei ole enää yliavain.</p>

<p><em>Pääavain</em> (<em>primary key</em>) on yksi avaimista, joka on nostettu erikoisasemaan.</p>

<h3 id="esimerkki-1">Esimerkki</h3>

<p>Tarkastellaan esimerkkinä tuotteita kuvaavaa relaatiota, jonka attribuutit ovat <code class="language-html highlighter-rouge">id</code>, <code class="language-html highlighter-rouge">nimi</code> ja <code class="language-html highlighter-rouge">hinta</code>.</p>

<p>Koska attribuutti <code class="language-html highlighter-rouge">id</code> yksilöi jokaisen monikon, se on yliavain. Myös yhdistelmät (<code class="language-html highlighter-rouge">id</code>, <code class="language-html highlighter-rouge">nimi</code>), (<code class="language-html highlighter-rouge">id</code>, <code class="language-html highlighter-rouge">hinta</code>) ja (<code class="language-html highlighter-rouge">id</code>, <code class="language-html highlighter-rouge">nimi</code>, <code class="language-html highlighter-rouge">hinta</code>) ovat yliavaimia, koska niiden osana on attribuutti <code class="language-html highlighter-rouge">id</code>. Kuitenkin näistä yliavaimista vain <code class="language-html highlighter-rouge">id</code> on avain, koska muut yliavaimet eivät ole minimaalisia.</p>

<p>Attribuutti <code class="language-html highlighter-rouge">hinta</code> ei selkeästi ole yliavain, koska monella tuotteella voi olla sama hinta. Attribuutti <code class="language-html highlighter-rouge">nimi</code> on yliavain siinä tapauksessa, että usealla tuotteella ei voi olla samaa nimeä. Yhdistelmä (<code class="language-html highlighter-rouge">nimi</code>, <code class="language-html highlighter-rouge">hinta</code>) on yliavain, jos ei voi olla kahta tuotetta, joilla olisi sekä sama nimi että sama hinta. Riippuu siis tietoon liittyvistä oletuksista, mitkä attribuuttien yhdistelmät ovat yliavaimia.</p>

<h3 id="avaimen-valinta">Avaimen valinta</h3>

<p>Avain voi olla joko <em>luonnollinen avain</em> (<em>natural key</em>) tai <em>sijaisavain</em> (<em>surrogate key</em>). Luonnollinen avain muodostuu alkuperäisestä tiedosta, kun taas sijaisavain on lisätty mukaan nimenomaan sen takia, että siitä tulisi avain. Esimerkiksi <code class="language-html highlighter-rouge">nimi</code> on luonnollinen avain, kun taas <code class="language-html highlighter-rouge">id</code> on sijaisavain.</p>

<p>Tietokantojen teoriassa näkee usein käytettävän luonnollisia avaimia, mutta käytännössä on hyvin tavallista käyttää id-numeroa tai vastaavaa sijaisavainta. Tässä on etuna, että id-numero on kompakti tieto, joka kelpaa varmasti avaimeksi. Jos valittaisiin luonnollinen avain, siihen kuuluisi ehkä monia attribuutteja ja pitäisi pohtia, riittävätkö attribuutit varmasti yksilöimään monikon kaikissa tapauksissa.</p>

<h3 id="funktionaalinen-riippuvuus">Funktionaalinen riippuvuus</h3>

<p><em>Funktionaalinen riippuvuus</em> (<em>functional dependency</em>) \(A \to B\) tarkoittaa, että attribuutit \(A\) määräävät attribuutit \(B\). Toisin sanoen jos relaatiossa on kaksi monikkoa, joissa attribuutit \(A\) ovat samat, niin myös attribuutit \(B\) ovat samat.</p>

<p>Esimerkiksi jos relaatiossa on attribuutit <code class="language-html highlighter-rouge">postinumero</code> ja <code class="language-html highlighter-rouge">kaupunki</code>, siinä on funktionaalinen riippuvuus <code class="language-html highlighter-rouge">postinumero</code> \(\to\) <code class="language-html highlighter-rouge">kaupunki</code>, koska postinumerosta voidaan päätellä kaupunki. Ei voi olla kahta monikkoa, joissa olisi sama postinumero mutta eri kaupunki.</p>

<p>Attribuutit \(A\) muodostavat yliavaimen tarkalleen silloin, kun \(A \to B\) pätee mille tahansa attribuuteille \(B\). Tässä tapauksessa koska \(A\) on yliavain, relaatiossa ei voi olla kahta monikkoa, jossa attribuutit \(A\) ovat samat.</p>

<h2 id="normaalimuodot">Normaalimuodot</h2>

<p>Normaalimuodot ovat tietokannan suunnitteluun liittyviä vaatimuksia, joiden tavoitteena on edistää tiedon eheyttä ja helpottaa tietokannan käyttämistä.</p>

<p>Ensimmäinen normaalimuoto vaatii, että tietokannassa on käytössä relaatiomalli. SQL:ssä määritelty taulu toteuttaa automaattisesti ensimmäisen normaalimuodon.</p>

<p>Toinen ja kolmas normaalimuoto liittyvät attribuuttien riippuvuuksiin. Näiden pohjalta on edelleen kehitetty Boyce–Codd-normaalimuoto, johon tutustumme seuraavaksi.</p>

<h3 id="boycecodd-normaalimuoto">Boyce–Codd-normaalimuoto</h3>

<p>Relaatio toteuttaa Boyce–Codd-normaalimuodon, jos jokaisessa siinä olevassa funktionaalisessa riippuvuudessa \(X \to Y\) pätee, että \(Y \subset X\) tai \(X\) on yliavain.</p>

<p>Ideana on varmistaa, että relaatiossa ei ole riippuvuuksia, jotka eivät liittyisi relaation avaimiin. Jos tällaisia riippuvuuksia on olemassa, ne tulisi esittää erillisessä relaatiossa.</p>

<p>Jos \(Y \subset X\), niin attribuutit \(Y\) ovat osa attribuutteja \(X\). Tällainen riippuvuus on voimassa aina, eli se ei kerro mitään erityistä. Esimerkki tästä on riippuvuus (<code class="language-html highlighter-rouge">nimi</code>, <code class="language-html highlighter-rouge">hinta</code>) \(\to\) <code class="language-html highlighter-rouge">hinta</code>.</p>

<p>Jos \(X\) on yliavain, niin riippuvuus \(X \to Y\) kuuluu asiaan, koska yliavain määrää kaikki attribuutit. Esimerkki tästä on riippuvuus <code class="language-html highlighter-rouge">id</code> \(\to\) <code class="language-html highlighter-rouge">nimi</code>.</p>

<p>Jos relaatio toteuttaa Boyce–Codd-normaalimuodon, niin se toteuttaa myös ensimmäisen, toisen ja kolmannen normaalimuodon.</p>

<h3 id="esimerkki-2">Esimerkki</h3>

<p>Tarkastellaan esimerkkinä seuraavaa taulua <code class="language-html highlighter-rouge">Suoritukset</code>, jossa on kurssisuorituksia:</p>

<table class="db-table">
<thead>
  <tr><th colspan="4" id="table-title">Suoritukset</th></tr>
  <tr><th width="30">id</th><th width="100">opiskelija_id</th><th width="100">kurssi_id</th><th width="100">op</th></tr>
</thead>
<tbody>
  <tr><td>1</td><td>123123</td><td>111</td><td>5</td></tr>
  <tr><td>2</td><td>321321</td><td>111</td><td>5</td></tr>
  <tr><td>3</td><td>123123</td><td>222</td><td>10</td></tr>
  <tr><td>4</td><td>321321</td><td>333</td><td>5</td></tr>
</tbody>
</table>

<p>Oletetaan, että jokaisella kurssilla on kiinteä opintopisteiden määrä, jolloin taulussa on riippuvuus <code class="language-html highlighter-rouge">kurssi_id</code> \(\to\) <code class="language-html highlighter-rouge">op</code>. Tämä on vastoin Boyce–Codd-normaalimuotoa, koska sarake <code class="language-html highlighter-rouge">op</code> ei ole osa saraketta <code class="language-html highlighter-rouge">kurssi_id</code> eikä sarake <code class="language-html highlighter-rouge">kurssi_id</code> ole yliavain.</p>

<p>Asia voidaan korjata tallentamalla kurssien opintopisteet erilliseen tauluun:</p>

<table class="db-table">
<thead>
  <tr><th colspan="3" id="table-title">Suoritukset</th></tr>
  <tr><th width="30">id</th><th width="100">opiskelija_id</th><th width="100">kurssi_id</th></tr>
</thead>
<tbody>
  <tr><td>1</td><td>123123</td><td>111</td></tr>
  <tr><td>2</td><td>321321</td><td>111</td></tr>
  <tr><td>3</td><td>123123</td><td>222</td></tr>
  <tr><td>4</td><td>321321</td><td>333</td></tr>
</tbody>
</table>

<table class="db-table">
<thead>
  <tr><th colspan="2" id="table-title">Kurssit</th></tr>
  <tr><th width="50">id</th><th width="100">op</th></tr>
</thead>
<tbody>
  <tr><td>111</td><td>5</td></tr>
  <tr><td>222</td><td>10</td></tr>
  <tr><td>333</td><td>5</td></tr>
</tbody>
</table>

<p>Tämän muutoksen jälkeen molemmat taulut noudattavat Boyce–Codd-normaalimuotoa.</p>

<h3 id="teoria-vs-käytäntö-2">Teoria vs. käytäntö</h3>

<p>Normaalimuotojen merkityksenä on, että ne antavat matemaattisen näkökulman tietokantojen suunnitteluun. Esimerkiksi jos tietokanta ei toteuta Boyce–Codd-normaalimuotoa, tietokannan rakennetta voi luultavasti parantaa.</p>

<p>Käytännössä tietokantoja ei kuitenkaan yleensä suunnitella normaalimuotojen avulla vaan luvun 6 periaatteiden tyylisesti. Normaalimuodot kuvaavat osan siitä, millainen ajattelutapa on pätevällä tietokantojen suunnittelijalla.</p>


</div>
        <div class="footer">
    <img src=/syksy-2023/assets/img/HY_logo.png>
    </div>
    </div>
</body>

</html>